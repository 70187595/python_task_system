<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π Python{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    
    <style>
        .navbar-brand {
            font-weight: bold;
        }
        .code-editor {
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-result {
            margin-bottom: 10px;
        }
        .test-passed {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .test-failed {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .quality-score {
            font-size: 1.2em;
            font-weight: bold;
        }
        .score-excellent { color: #28a745; }
        .score-good { color: #ffc107; }
        .score-poor { color: #dc3545; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è CodeMirror */
        .CodeMirror {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
        }
        
        .CodeMirror-focused .CodeMirror-cursor {
            border-left: 1px solid #000;
        }
        
        .CodeMirror-selected {
            background: #b3d4fc;
        }
        
        .CodeMirror-linenumber {
            color: #999;
            padding-right: 8px;
        }
        
        .CodeMirror-gutters {
            background: #f8f8f8;
            border-right: 1px solid #ddd;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ textarea */
        .code-textarea {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
            font-size: 14px !important;
            line-height: 1.4 !important;
            background: #f8f8f8 !important;
            border: 1px solid #ddd !important;
            border-radius: 4px !important;
            padding: 10px !important;
            resize: vertical !important;
        }
        
        .code-textarea:focus {
            border-color: #007bff !important;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25) !important;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                üêç Python Task System
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.generate_task') }}">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.list_tasks') }}">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.train_model_page') }}">ü§ñ –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.compare_models_page') }}">üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π</a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showStatistics()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="bg-light mt-5 py-4">
        <div class="container text-center">
            <p class="text-muted mb-0">
                ¬© 2025 –°–æ–∫–æ–ª—é–∫ –ê.–í. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π Python
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function showStatistics() {
            fetch('/api/statistics')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const stats = data.statistics;
                        const modalHtml = `
                            <div class="modal fade" id="statisticsModal" tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h6>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                                                    <ul class="list-unstyled">
                                                        <li><strong>–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π:</strong> ${stats.total_tasks || 0}</li>
                                                        <li><strong>–í—Å–µ–≥–æ —Ä–µ—à–µ–Ω–∏–π:</strong> ${stats.total_solutions || 0}</li>
                                                        <li><strong>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞:</strong> ${stats.average_score || 0}%</li>
                                                    </ul>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6>–ó–∞–¥–∞–Ω–∏—è –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h6>
                                                    <ul class="list-unstyled">
                                                        ${Object.entries(stats.tasks_by_difficulty || {}).map(([difficulty, count]) => 
                                                            `<li><strong>${difficulty}:</strong> ${count}</li>`
                                                        ).join('')}
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-12">
                                                    <h6>–ó–∞–¥–∞–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h6>
                                                    <ul class="list-unstyled">
                                                        ${Object.entries(stats.tasks_by_category || {}).map(([category, count]) => 
                                                            `<li><strong>${category}:</strong> ${count}</li>`
                                                        ).join('')}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥–∞–ª –µ—Å–ª–∏ –µ—Å—Ç—å
                        const existingModal = document.getElementById('statisticsModal');
                        if (existingModal) {
                            existingModal.remove();
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –º–æ–¥–∞–ª
                        document.body.insertAdjacentHTML('beforeend', modalHtml);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª
                        const modal = new bootstrap.Modal(document.getElementById('statisticsModal'));
                        modal.show();
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                    alert('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞
        function initCodeEditor(elementId, defaultValue = '') {
            const textarea = document.getElementById(elementId);
            const editor = CodeMirror.fromTextArea(textarea, {
                mode: 'python',
                theme: 'monokai',
                lineNumbers: true,
                indentUnit: 4,
                indentWithTabs: false,
                lineWrapping: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                value: defaultValue
            });
            return editor;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        function formatExecutionTime(time) {
            return (time * 1000).toFixed(2) + ' –º—Å';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ –æ—Ü–µ–Ω–∫–∏
        function getScoreClass(score) {
            if (score >= 80) return 'score-excellent';
            if (score >= 60) return 'score-good';
            return 'score-poor';
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
