{% extends "base.html" %}

{% block title %}–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π - Python Task System{% endblock %}

{% block extra_css %}
<style>
    .comparison-card {
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    
    .model-selector {
        margin-bottom: 20px;
    }
    
    .comparison-table {
        font-size: 0.9em;
    }
    
    .comparison-table th {
        background-color: #f8f9fa;
        font-weight: bold;
    }
    
    .best-value {
        background-color: #d4edda;
        font-weight: bold;
        color: #155724;
    }
    
    .worst-value {
        background-color: #f8d7da;
        color: #721c24;
    }
    
    .chart-container {
        position: relative;
        height: 400px;
        margin-bottom: 30px;
    }
    
    .model-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85em;
        margin-right: 5px;
    }
    
    .badge-baseline {
        background-color: #007bff;
        color: white;
    }
    
    .badge-best {
        background-color: #28a745;
        color: white;
    }
    
    .badge-experiment {
        background-color: #6c757d;
        color: white;
    }
    
    .stats-card {
        text-align: center;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f8f9fa;
    }
    
    .stats-value {
        font-size: 2em;
        font-weight: bold;
        color: #007bff;
    }
    
    .stats-label {
        color: #666;
        margin-top: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h1><i class="bi bi-bar-chart-line"></i> –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π</h1>
            <p class="text-muted">–ê–Ω–∞–ª–∏–∑ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π</p>
        </div>
    </div>
    
    <!-- –í—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π -->
    <div class="card comparison-card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">üéØ –í—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª–∏ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ):</label>
                    <select class="form-select" id="models-selector" multiple size="8">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π...</option>
                    </select>
                    <small class="text-muted">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (Cmd –Ω–∞ Mac) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π</small>
                </div>
                <div class="col-md-6">
                    <label class="form-label">–í–∫–ª—é—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="include-experiments" checked>
                        <label class="form-check-label" for="include-experiments">
                            –í–∫–ª—é—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ experiments/results/
                        </label>
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-primary" onclick="compareModels()">
                            <i class="bi bi-play-fill"></i> –°—Ä–∞–≤–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
                        </button>
                        <button class="btn btn-secondary" onclick="compareAll()">
                            <i class="bi bi-list-ul"></i> –°—Ä–∞–≤–Ω–∏—Ç—å –≤—Å–µ
                        </button>
                        <button class="btn btn-info" onclick="showBestModels()">
                            <i class="bi bi-trophy"></i> –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-3
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è -->
    <div id="comparison-results" style="display: none;">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="card comparison-card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-value" id="models-count">0</div>
                            <div class="stats-label">–ú–æ–¥–µ–ª–µ–π —Å—Ä–∞–≤–Ω–µ–Ω–æ</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-value" id="best-loss">-</div>
                            <div class="stats-label">–õ—É—á—à–∞—è –æ—à–∏–±–∫–∞</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-value" id="avg-loss">-</div>
                            <div class="stats-label">–°—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-value" id="improvement">-</div>
                            <div class="stats-label">–£–ª—É—á—à–µ–Ω–∏–µ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è -->
        <div class="card comparison-card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">üìã –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover comparison-table" id="comparison-table">
                        <thead>
                            <tr>
                                <th>–ú–æ–¥–µ–ª—å</th>
                                <th>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</th>
                                <th>Learning Rate</th>
                                <th>–ê–∫—Ç–∏–≤–∞—Ü–∏—è</th>
                                <th>Dropout</th>
                                <th>–§–∏–Ω–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞</th>
                                <th>–ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è -->
        <div class="card comparison-card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">üìà –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ</h5>
            </div>
            <div class="card-body">
                <!-- –ì—Ä–∞—Ñ–∏–∫ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ -->
                <div class="chart-container">
                    <h6 class="text-center">–§–∏–Ω–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –º–æ–¥–µ–ª–µ–π</h6>
                    <canvas id="final-errors-chart"></canvas>
                </div>
                
                <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ -->
                <div class="chart-container">
                    <h6 class="text-center">–í–ª–∏—è–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è</h6>
                    <canvas id="architecture-chart"></canvas>
                </div>
                
                <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–æ learning rate -->
                <div class="chart-container">
                    <h6 class="text-center">–í–ª–∏—è–Ω–∏–µ learning rate</h6>
                    <canvas id="learning-rate-chart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
        <div class="card comparison-card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h5>
            </div>
            <div class="card-body" id="recommendations">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<script>
    let comparisonData = [];
    let charts = {};
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        loadModelsForComparison();
    });
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
    async function loadModelsForComparison() {
        const selector = document.getElementById('models-selector');
        selector.innerHTML = '<option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>';
        
        try {
            const response = await fetch('/api/list-models');
            const result = await response.json();
            
            if (result.success) {
                selector.innerHTML = '';
                
                result.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.name;
                    option.textContent = `${model.name} (${(model.size/1024).toFixed(2)} KB)`;
                    option.dataset.info = JSON.stringify(model);
                    selector.appendChild(option);
                });
            }
        } catch (error) {
            selector.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π:', error);
        }
    }
    
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
    async function compareModels() {
        const selector = document.getElementById('models-selector');
        const selectedOptions = Array.from(selector.selectedOptions);
        
        if (selectedOptions.length === 0) {
            alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –º–æ–¥–µ–ª—å –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è');
            return;
        }
        
        const modelNames = selectedOptions.map(opt => opt.value);
        const includeExperiments = document.getElementById('include-experiments').checked;
        
        try {
            const response = await fetch('/api/compare-models', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    models: modelNames,
                    include_experiments: includeExperiments
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                displayComparisonResults(result.comparison);
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.error);
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π: ' + error.message);
        }
    }
    
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
    async function compareAll() {
        const includeExperiments = document.getElementById('include-experiments').checked;
        
        try {
            const response = await fetch('/api/compare-models', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    models: 'all',
                    include_experiments: includeExperiments
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                displayComparisonResults(result.comparison);
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.error);
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π: ' + error.message);
        }
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-3 –º–æ–¥–µ–ª–∏
    async function showBestModels() {
        await compareAll();
        // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –æ—à–∏–±–∫–µ
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    function displayComparisonResults(data) {
        comparisonData = data.models;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        document.getElementById('comparison-results').style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('models-count').textContent = comparisonData.length;
        document.getElementById('best-loss').textContent = data.best_loss.toFixed(6);
        document.getElementById('avg-loss').textContent = data.avg_loss.toFixed(6);
        document.getElementById('improvement').textContent = 
            ((1 - data.best_loss / data.avg_loss) * 100).toFixed(1) + '%';
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
        fillComparisonTable();
        
        // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
        createCharts();
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        generateRecommendations(data);
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
        document.getElementById('comparison-results').scrollIntoView({ behavior: 'smooth' });
    }
    
    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    function fillComparisonTable() {
        const tbody = document.querySelector('#comparison-table tbody');
        tbody.innerHTML = '';
        
        // –ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏–µ –∏ —Ö—É–¥—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
        const losses = comparisonData.map(m => m.final_loss);
        const bestLoss = Math.min(...losses);
        const worstLoss = Math.max(...losses);
        
        comparisonData.forEach((model, index) => {
            const row = tbody.insertRow();
            
            // –ú–æ–¥–µ–ª—å
            const cellModel = row.insertCell();
            cellModel.innerHTML = `<strong>${model.name}</strong>`;
            if (index === 0) cellModel.innerHTML += ' <span class="model-badge badge-best">üèÜ –õ–£–ß–®–ê–Ø</span>';
            
            // –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
            row.insertCell().textContent = 
                `${model.input_size}‚Üí${model.hidden_size}‚Üí${model.output_size}`;
            
            // Learning Rate
            row.insertCell().textContent = model.learning_rate || 'N/A';
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è
            row.insertCell().textContent = model.activation || 'N/A';
            
            // Dropout
            row.insertCell().textContent = model.dropout_rate || '0.0';
            
            // –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞
            const cellLoss = row.insertCell();
            cellLoss.textContent = model.final_loss.toFixed(6);
            if (model.final_loss === bestLoss) {
                cellLoss.className = 'best-value';
            } else if (model.final_loss === worstLoss) {
                cellLoss.className = 'worst-value';
            }
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const params = model.input_size * model.hidden_size + 
                          model.hidden_size * model.output_size +
                          model.hidden_size + model.output_size;
            row.insertCell().textContent = params;
        });
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    function createCharts() {
        // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
        Object.values(charts).forEach(chart => chart.destroy());
        charts = {};
        
        // –ì—Ä–∞—Ñ–∏–∫ 1: –§–∏–Ω–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
        const ctx1 = document.getElementById('final-errors-chart').getContext('2d');
        charts.finalErrors = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: comparisonData.map(m => m.name),
                datasets: [{
                    label: '–§–∏–Ω–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞',
                    data: comparisonData.map(m => m.final_loss),
                    backgroundColor: comparisonData.map((m, i) => 
                        i === 0 ? 'rgba(40, 167, 69, 0.7)' : 'rgba(75, 192, 192, 0.7)'
                    ),
                    borderColor: comparisonData.map((m, i) => 
                        i === 0 ? 'rgb(40, 167, 69)' : 'rgb(75, 192, 192)'
                    ),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Loss (MSE)'
                        }
                    }
                }
            }
        });
        
        // –ì—Ä–∞—Ñ–∏–∫ 2: –í–ª–∏—è–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è
        const hiddenSizes = [...new Set(comparisonData.map(m => m.hidden_size))].sort((a, b) => a - b);
        const avgLossByHidden = hiddenSizes.map(size => {
            const models = comparisonData.filter(m => m.hidden_size === size);
            return models.reduce((sum, m) => sum + m.final_loss, 0) / models.length;
        });
        
        const ctx2 = document.getElementById('architecture-chart').getContext('2d');
        charts.architecture = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: hiddenSizes,
                datasets: [{
                    label: '–°—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞',
                    data: avgLossByHidden,
                    borderColor: 'rgb(255, 99, 132)',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '–†–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '–°—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ (MSE)'
                        }
                    }
                }
            }
        });
        
        // –ì—Ä–∞—Ñ–∏–∫ 3: –í–ª–∏—è–Ω–∏–µ learning rate
        const learningRates = [...new Set(comparisonData.map(m => m.learning_rate).filter(lr => lr))].sort((a, b) => a - b);
        const avgLossByLR = learningRates.map(lr => {
            const models = comparisonData.filter(m => m.learning_rate === lr);
            return models.reduce((sum, m) => sum + m.final_loss, 0) / models.length;
        });
        
        const ctx3 = document.getElementById('learning-rate-chart').getContext('2d');
        charts.learningRate = new Chart(ctx3, {
            type: 'line',
            data: {
                labels: learningRates.map(lr => lr.toString()),
                datasets: [{
                    label: '–°—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞',
                    data: avgLossByLR,
                    borderColor: 'rgb(54, 162, 235)',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Learning Rate'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '–°—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ (MSE)'
                        }
                    }
                }
            }
        });
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    function generateRecommendations(data) {
        const container = document.getElementById('recommendations');
        let html = '<h6>–û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:</h6><ul>';
        
        // –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å
        const best = comparisonData[0];
        html += `<li><strong>–õ—É—á—à–∞—è –º–æ–¥–µ–ª—å:</strong> ${best.name} —Å –æ—à–∏–±–∫–æ–π ${best.final_loss.toFixed(6)}</li>`;
        
        // –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è
        const hiddenSizes = {};
        comparisonData.forEach(m => {
            if (!hiddenSizes[m.hidden_size]) hiddenSizes[m.hidden_size] = [];
            hiddenSizes[m.hidden_size].push(m.final_loss);
        });
        
        let optimalHidden = null;
        let minAvgLoss = Infinity;
        for (const [size, losses] of Object.entries(hiddenSizes)) {
            const avg = losses.reduce((a, b) => a + b, 0) / losses.length;
            if (avg < minAvgLoss) {
                minAvgLoss = avg;
                optimalHidden = size;
            }
        }
        html += `<li><strong>–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è:</strong> ${optimalHidden} –Ω–µ–π—Ä–æ–Ω–æ–≤ (—Å—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: ${minAvgLoss.toFixed(6)})</li>`;
        
        // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
        html += '<li><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><ul>';
        html += `<li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ learning rate ${best.learning_rate} –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</li>`;
        html += `<li>–§—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ${best.activation} –ø–æ–∫–∞–∑–∞–ª–∞ —Ö–æ—Ä–æ—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</li>`;
        if (best.dropout_rate > 0) {
            html += `<li>Dropout ${best.dropout_rate} –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ</li>`;
        }
        html += '</ul></li>';
        
        html += '</ul>';
        container.innerHTML = html;
    }
</script>
{% endblock %}

